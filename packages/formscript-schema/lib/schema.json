{
  "$schema": "http://json-schema.org/draft-06/schema#",

  "title": "FormScript Schema",
  "description": "A simple way to define feature-rich web forms",
  "version": "0.0.1",

  "definitions": {

    "id": {"type": "string", "title": "A unique string which identifies the widget - often used to bind the value being collected by a widget to an underlying data model. Providing an `id` value is very often mandatory (depending on the type of widget involved). Regardless, it is good practice to always provide an `id` because it assists modification (or \"_patching_\") of form definitions."},
    "type": {"type": "string", "title": "A mandatory value denoting the type of widget being defined (e.g. `text`, `number` etc.)"},
    "showWhen": {"type": "string", "title": "An expression, that when evaluating to `true` will cause the widget to appear (so the widget will not be shown if evaluated to be `false`)."},

    "attributes": {
      "heading": {"type": "string", "title": "Some short, strong, punchy text to identify the widget."},
      "placeholder": {"type": "string", "title": "Some example text that can be appear ina widget ahead of collecting use input. "},
      "minCharacters": {"type": "number", "title": "The minimum length of number of characters a will need to provide.", "min": 1},
      "maxCharacters": {"type": "number", "title": "The maximum length of number of characters a user can specify."},
      "numericValue": {"type": "value", "title": "Explicitly assert that the widget receive and store numeric values (usually of use with title-map enumerations)."},
      "default": {"type": "any", "title": "A value to default a widget to if not supplied by other mechanisms."},
      "defaultString": {"type": "string", "title": "A string value to default a widget to if not supplied by other mechanisms."},
      "defaultNumber": {"type": "number", "title": "A numeric value to default a widget to if not supplied by other mechanisms."},
      "defaultBoolean": {"type": "boolean", "title": "A boolean value to default a widget to if not supplied by other mechanisms."},
      "enabled": {"type": "boolean", "title": "Indicates if the user can use the widget to alter the underlying value - default to `true`."},
      "label": {"type": "string", "title": "A short piece of text to help identify what content is required by the user."},
      "mandatory": {"type": "boolean", "title": "Indicates if a value needs to be supplied by the user, or if it's optional."},
      "desc": {"type": "string", "title": "Some additional advice (above and beyond the string supplied in `label`) to help define what data is required from the user."},
      "help": {"type": "string", "title": "More detailed guidance/advice (building on top of `description` content) to help shape what data is collected from the user."},
      "titleMap": {
        "type": "array",
        "title": "An array of objects denoting a set of values that the user can select from.",
        "items": {
          "properties": {
            "value": {"type": "any", "title": "The value that will be provided and saved."},
            "title": {"type": "string", "title": "The user-facing text that can be offered as an alternative to the underlying `value`."},
            "desc": {"type": "string", "title": "Adds more descriptive detail to the title"}
          },
          "additionalProperties": false,
          "required": ["value"]
        }
      }
    },

    "widgets": {

      "address": {
        "title": "Allows the user to __select__ a particular postal address from a provided list and store a unique reference to that property, such as a [UPRN](https://www.ordnancesurvey.co.uk/about/governance/policies/addressbase-uprn.html) or similar.",
        "properties": {
          "type": {"enum": ["address"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
              "heading": {"$ref": "#/definitions/attributes/heading"},
              "desc": {"$ref": "#/definitions/attributes/desc"},
              "mandatory": {"$ref": "#/definitions/attributes/mandatory"}
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "apiLookup": {
        "title": "Allows the user to select a specific value from an API endpoint",
        "properties": {
          "type": {"enum": ["apiLookup"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
              "heading": {"$ref": "#/definitions/attributes/heading"},
              "desc": {"$ref": "#/definitions/attributes/desc"},
              "mandatory": {"$ref": "#/definitions/attributes/mandatory"}
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "checkboxList": {
        "title": "Offer a related set of checkboxes with accompanying labels for the user to switch on and off.",
        "properties": {
          "type": {"enum": ["checkboxList"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
              "heading": {"$ref": "#/definitions/attributes/heading"},
              "default": {"$ref": "#/definitions/attributes/default"},
              "desc": {"$ref": "#/definitions/attributes/desc"},
              "titleMap": {"$ref": "#/definitions/attributes/titleMap"},
              "mandatory": {"$ref": "#/definitions/attributes/mandatory"},
              "minLimit": {
                "type": "number",
                "default": "0",
                "title": "Minimum number of array elements the user should provide"

              },
              "maxLimit": {
                "type": "number",
                "title": "Maximum number of array elements the user should provide"
              }
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "date": {
        "title": "Allows the user to provide a specific date - without a time portion.",
        "properties": {
          "type": {"enum": ["date"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "dateTime": {
        "title": "Collects a specific date and time from the user.",
        "properties": {
          "type": {"enum": ["dateTime"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "time": {
        "title": "Allows the user to provide a specific time (without being tied to a particular date)",
        "properties": {
          "type": {"enum": ["time"]},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "id": {"$ref": "#/definitions/id"},
          "attributes": {
            "type": "object",
            "properties": {
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "header": {
        "title": "Displays a header for a form (with an optional background image and some text akin to a '[Hero Unit](https://en.wikipedia.org/wiki/Hero_image)' component).",
        "properties": {
          "type": {"enum": ["header"]},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
              "heading": {"$ref": "#/definitions/attributes/heading"},
              "desc": {"$ref": "#/definitions/attributes/desc"},
              "backgroundImage": {"type": "string"},
              "backgroundImageAltText": {"type": "string"}
            },
            "required": ["heading"],
            "additionalProperties": false
          }
        },
        "required": ["type"],
        "additionalProperties": false
      },

      "questionnaire": {
        "title": "Offers the user a question with two or more possible responses on an appropriate scale.",
        "properties": {
          "type": {"enum": ["questionnaire"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
              "heading": {"$ref": "#/definitions/attributes/heading"},
              "default": {"$ref": "#/definitions/attributes/default"},
              "desc": {"$ref": "#/definitions/attributes/desc"},
              "numericValue": {"$ref": "#/definitions/attributes/numericValue"},
              "titleMap": {"$ref": "#/definitions/attributes/titleMap"},
              "mandatory": {"$ref": "#/definitions/attributes/mandatory"}
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "subForm": {
        "title": "Allows the user to enter a number of 'sub forms' (think order-lines or contact details etc.)",
        "properties": {
          "type": {"enum": ["subForm"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },


      "radio": {
        "title": "Allows the user to select a value from a set of related options that are rendered in a [Radio Button](https://en.wikipedia.org/wiki/Radio_button) style.",
        "properties": {
          "type": {"enum": ["radio"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
              "heading": {"$ref": "#/definitions/attributes/heading"},
              "desc": {"$ref": "#/definitions/attributes/desc"},
              "mandatory": {"$ref": "#/definitions/attributes/mandatory"},
              "numericValue": {"$ref": "#/definitions/attributes/numericValue"},
              "titleMap": {"$ref": "#/definitions/attributes/titleMap"}
            }
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "richtext": {
        "title": "Offers the user a text editor with functionality to format text.",
        "properties": {
          "type": {"enum": ["richtext"]},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "id": {"$ref": "#/definitions/id"},
          "attributes": {
            "type": "object",
            "properties": {
              "heading": {"$ref": "#/definitions/attributes/heading"},
              "desc": {"$ref": "#/definitions/attributes/desc"},
              "mandatory": {"$ref": "#/definitions/attributes/mandatory"},
              "default": {"$ref": "#/definitions/attributes/defaultString"}
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "signature": {
        "title": "Allow the collection of a handwritten signature",
        "properties": {
          "type": {"enum": ["signature"]},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "id": {"$ref": "#/definitions/id"},
          "attributes": {
            "type": "object",
            "properties": {
              "heading": {"$ref": "#/definitions/attributes/heading"},
              "desc": {"$ref": "#/definitions/attributes/desc"},
              "mandatory": {"$ref": "#/definitions/attributes/mandatory"}
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "image": {
        "title": "Embeds a non-interactive image within the form.",
        "properties": {
          "type": {"enum": ["image"]},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "id": {"$ref": "#/definitions/id"},
          "attributes": {
            "type": "object",
            "properties": {
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "textarea": {
        "title": "Collects simple multi-line text input from the user.",
        "properties": {
          "type": {"enum": ["textarea"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "stickyNote": {
        "title": "A panel for putting helpful text or other informative text",
        "properties": {
          "type": {"enum": ["stickyNote"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "map": {
        "title": "Displays a map to the user, and can optionally be configured to collect geo-spatial data (points, lines etc.)",
        "properties": {
          "type": {"enum": ["map"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "fileUpload": {
        "title": "Allows the user to upload a file.",
        "properties": {
          "type": {"enum": ["fileUpload"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "set": {
        "title": "Marks the start of a set of related widgets - see the [Sets](#set) section for more information.",
        "properties": {
          "type": {"enum": ["set"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
              "heading": {"$ref": "#/definitions/attributes/heading"},
              "desc": {"$ref": "#/definitions/attributes/desc"},
              "showInTOC": {"type": "boolean", "title": "Should this set appear in a Table of Contents or similar, if the app supports such things?"}
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "endSet": {
        "title": "Marks the end of a set of related widgets - see the [Sets](#set) section for more information.",
        "properties": {
          "type": {"enum": ["endSet"]}
        },
        "required": ["type"],
        "additionalProperties": false
      },

      "endSubForm": {
        "title": "Marks the end of a sub-form - see the [Sets](#set) section for more information.",
        "properties": {
          "type": {"enum": ["endSet"]}
        },
        "required": ["type"],
        "additionalProperties": false
      },

      "select": {
        "title": "Allows the user to select a value from a set of options, which should be rendered in an [HTML Select](https://en.wikipedia.org/wiki/HTML_element) style.",
        "properties": {
          "type": {"enum": ["select"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
              "heading": {"$ref": "#/definitions/attributes/heading"},
              "desc": {"$ref": "#/definitions/attributes/desc"},
              "mandatory": {"$ref": "#/definitions/attributes/mandatory"},
              "default": {"$ref": "#/definitions/attributes/default"},
              "numericValue": {"$ref": "#/definitions/attributes/numericValue"},
              "titleMap": {"$ref": "#/definitions/attributes/titleMap"}
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "switch": {
        "title": "Presents a on/off style switch to the user.",
        "properties": {
          "type": {"enum": ["switch"]},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "id": {"$ref": "#/definitions/id"},
          "attributes": {
            "type": "object",
            "properties": {
              "heading": {"$ref": "#/definitions/attributes/heading"},
              "default": {"$ref": "#/definitions/attributes/defaultBoolean"},
              "desc": {"$ref": "#/definitions/attributes/desc"},
              "mandatory": {"$ref": "#/definitions/attributes/mandatory"}
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "text": {
        "title": "A bread-and-butter box for collecting textual information from the user.",
        "properties": {
          "type": {"enum": ["text"]},
          "id": {"$ref": "#/definitions/id"},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
              "heading": {"$ref": "#/definitions/attributes/heading"},
              "default": {"$ref": "#/definitions/attributes/defaultString"},
              "placeholder": {"$ref": "#/definitions/attributes/placeholder"},
              "mandatory": {"$ref": "#/definitions/attributes/mandatory"},
              "minCharacters": {"$ref": "#/definitions/attributes/minCharacters"},
              "maxCharacters": {"$ref": "#/definitions/attributes/maxCharacters"},
              "help": {"$ref": "#/definitions/attributes/help"}
            },
            "additionalProperties": false
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "number": {
        "title": "Like a `text` widget, but specifically for collecting numeric content.",
        "properties": {
          "id": {"type": "string"},
          "type": {"enum": ["number"]},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
              "default": {"$ref": "#/definitions/attributes/defaultNumber"}
            }
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "currency": {
        "title": "Just like a `number` widget, but for specifically collecting a monetary value.",
        "properties": {
          "id": {"type": "string"},
          "type": {"enum": ["currency"]},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
              "default": {"$ref": "#/definitions/attributes/defaultNumber"}
            }
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      },

      "slider": {
        "title": "For capturing a number along a specified range",
        "properties": {
          "id": {"type": "string"},
          "type": {"enum": ["slider"]},
          "showWhen": {"$ref": "#/definitions/showWhen"},
          "attributes": {
            "type": "object",
            "properties": {
              "default": {"$ref": "#/definitions/attributes/defaultNumber"}
            }
          }
        },
        "required": ["id", "type"],
        "additionalProperties": false
      }
    }
  },

  "type": "object",
  "properties": {

    "title": {
      "type": "string",
      "title": "A short-as-possible label to associate with the form."
    },

    "desc": {
      "type": "string",
      "title": "A quick summary of what the form is hoping to achieve."
    },

    "version": {
      "type": "string",
      "title": "Denotes the current version of the form definition. This will be assigned by whatever tooling and processes conjure your forms. There is a strong preference that form version strings adhere to [Semantic Versioning](http://nodesource.com/blog/semver-a-primer/)."
    },

    "shasum": {
      "type": "string",
      "title": "Optionally assigned by tooling, this is a checksum value based on the form-definition. Uses include client-side storage management of form definitions and integrity checking."
    },

    "widgets": {
      "type": "array",
      "title": "The main event, 1 or more `widget` objects which an app should render to produce a form.",
      "minItems": 1,
      "items": {
        "type": "object",
        "oneOf": [
          {"$ref": "#/definitions/widgets/address"},
          {"$ref": "#/definitions/widgets/apiLookup"},
          {"$ref": "#/definitions/widgets/checkboxList"},
          {"$ref": "#/definitions/widgets/currency"},
          {"$ref": "#/definitions/widgets/date"},
          {"$ref": "#/definitions/widgets/dateTime"},
          {"$ref": "#/definitions/widgets/time"},
          {"$ref": "#/definitions/widgets/header"},
          {"$ref": "#/definitions/widgets/questionnaire"},
          {"$ref": "#/definitions/widgets/radio"},
          {"$ref": "#/definitions/widgets/richtext"},
          {"$ref": "#/definitions/widgets/signature"},
          {"$ref": "#/definitions/widgets/textarea"},
          {"$ref": "#/definitions/widgets/set"},
          {"$ref": "#/definitions/widgets/endSet"},
          {"$ref": "#/definitions/widgets/select"},
          {"$ref": "#/definitions/widgets/switch"},
          {"$ref": "#/definitions/widgets/text"},
          {"$ref": "#/definitions/widgets/number"},
          {"$ref": "#/definitions/widgets/map"},
          {"$ref": "#/definitions/widgets/fileUpload"},
          {"$ref": "#/definitions/widgets/subForm"},
          {"$ref": "#/definitions/widgets/endSubForm"},
          {"$ref": "#/definitions/widgets/stickyNote"},
          {"$ref": "#/definitions/widgets/image"}
        ]
      }
    }
  },
  "required": ["widgets"],
  "additionalProperties": false
}


